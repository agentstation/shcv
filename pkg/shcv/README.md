<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# shcv

```go
import "github.com/agentstation/shcv/pkg/shcv"
```

Package shcv provides functionality to synchronize Helm chart values by analyzing template files and updating values files accordingly.

The package helps maintain Helm charts by automatically detecting all \{\{ .Values.\* \}\} expressions in template files and ensuring they are properly defined in the values files. It uses atomic file operations to ensure data integrity and provides robust error handling.

Basic usage:

```
chart, err := shcv.NewChart("./my-chart")
if err != nil {
	log.Fatal(err)
}

// Process the chart
if err := chart.LoadValueFiles(); err != nil {
	log.Fatal(err)
}
if err := chart.FindTemplates(); err != nil {
	log.Fatal(err)
}
if err := chart.ParseTemplates(); err != nil {
	log.Fatal(err)
}
if err := chart.ProcessReferences(); err != nil {
	log.Fatal(err)
}
if err := chart.UpdateValueFiles(); err != nil {
	log.Fatal(err)
}
```

Configuration options:

```
chart, err := shcv.NewChart("./my-chart",
	shcv.WithValuesFileNames([]string{"values.yaml", "values-prod.yaml"}),
	shcv.WithTemplatesDir("custom-templates"),
	shcv.WithVerbose(true),
)
```

Key features:

- Detects all Helm value references in template files
- Supports multiple values files
- Supports nested value structures
- Handles default values in templates
- Creates missing values with their default values
- Preserves existing values, structure, and data types \(e.g., numbers, strings\)
- Provides line number and source file tracking
- Uses atomic file operations
- Provides robust error handling

Error handling:

- Invalid chart directory structure
- Missing or inaccessible templates directory
- Permission issues with values files
- Invalid YAML syntax
- Concurrent file access conflicts

Requirements:

- Go 1.21 or later
- Valid Helm chart directory structure
- Read/write permissions for chart directory

## Index

- [Constants](<#constants>)
- [type Chart](<#Chart>)
  - [func NewChart\(dir string, opts ...Option\) \(\*Chart, error\)](<#NewChart>)
  - [func \(c \*Chart\) FindTemplates\(\) error](<#Chart.FindTemplates>)
  - [func \(c \*Chart\) LoadValueFiles\(\) error](<#Chart.LoadValueFiles>)
  - [func \(c \*Chart\) ParseTemplates\(\) error](<#Chart.ParseTemplates>)
  - [func \(c \*Chart\) ProcessReferences\(\)](<#Chart.ProcessReferences>)
  - [func \(c \*Chart\) UpdateValueFiles\(\) error](<#Chart.UpdateValueFiles>)
- [type Option](<#Option>)
  - [func WithTemplatesDir\(dir string\) Option](<#WithTemplatesDir>)
  - [func WithValuesFileNames\(names \[\]string\) Option](<#WithValuesFileNames>)
  - [func WithVerbose\(verbose bool\) Option](<#WithVerbose>)
- [type ValueFile](<#ValueFile>)
- [type ValueRef](<#ValueRef>)
  - [func ParseFile\(content, templatePath string\) \[\]ValueRef](<#ParseFile>)
  - [func \(v \*ValueRef\) ID\(\) string](<#ValueRef.ID>)


## Constants

<a name="Version"></a>Version is the current version of shcv

```go
const Version = "1.0.7"
```

<a name="Chart"></a>
## type [Chart](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L46-L57>)

Chart represents a Helm chart structure and manages its values and templates. It provides functionality to scan templates for value references and ensure all referenced values are properly defined in values.yaml.

```go
type Chart struct {
    // Dir is the root directory of the chart
    Dir string
    // ValuesFiles is the path to values.yaml
    ValuesFiles []ValueFile
    // References tracks all .Values references found in templates
    References []ValueRef
    // Templates lists all discovered template files
    Templates []string
    // contains filtered or unexported fields
}
```

<a name="NewChart"></a>
### func [NewChart](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L60>)

```go
func NewChart(dir string, opts ...Option) (*Chart, error)
```

NewChart creates a new Chart instance for the given directory.

<a name="Chart.FindTemplates"></a>
### func \(\*Chart\) [FindTemplates](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L131>)

```go
func (c *Chart) FindTemplates() error
```

FindTemplates discovers all template files in the chart's templates directory. It looks for files with .yaml, .yml, or .tpl extensions. Returns an error if the templates directory cannot be accessed.

<a name="Chart.LoadValueFiles"></a>
### func \(\*Chart\) [LoadValueFiles](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L96>)

```go
func (c *Chart) LoadValueFiles() error
```

LoadValueFiles loads the current values from the value files provided. If the file doesn't exist, an empty values map is initialized. Returns an error if the file exists but cannot be read or parsed.

<a name="Chart.ParseTemplates"></a>
### func \(\*Chart\) [ParseTemplates](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L157>)

```go
func (c *Chart) ParseTemplates() error
```

ParseTemplates scans all discovered templates for .Values references. It identifies both simple references and those with default values. The references are stored in the Chart's References slice.

<a name="Chart.ProcessReferences"></a>
### func \(\*Chart\) [ProcessReferences](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L205>)

```go
func (c *Chart) ProcessReferences()
```

ProcessReferences ensures all referenced values exist in values.yaml.

<a name="Chart.UpdateValueFiles"></a>
### func \(\*Chart\) [UpdateValueFiles](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L479>)

```go
func (c *Chart) UpdateValueFiles() error
```

UpdateValueFiles ensures all referenced values exist in values.yaml. It adds missing values with appropriate defaults and updates the file. The operation is skipped if no changes are needed.

<a name="Option"></a>
## type [Option](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/config.go#L39>)

Option is a functional option for configuring the Chart processing.

```go
type Option func(*config)
```

<a name="WithTemplatesDir"></a>
### func [WithTemplatesDir](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/config.go#L49>)

```go
func WithTemplatesDir(dir string) Option
```

WithTemplatesDir sets the templates directory.

<a name="WithValuesFileNames"></a>
### func [WithValuesFileNames](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/config.go#L42>)

```go
func WithValuesFileNames(names []string) Option
```

WithValuesFileNames sets the values file names.

<a name="WithVerbose"></a>
### func [WithVerbose](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/config.go#L56>)

```go
func WithVerbose(verbose bool) Option
```

WithVerbose sets the verbose flag.

<a name="ValueFile"></a>
## type [ValueFile](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L34-L41>)

ValueFile represents a values file

```go
type ValueFile struct {
    // Path is the path to the values file
    Path string
    // Values contains the values from the values file
    Values map[string]any
    // Changed indicates whether values were modified during processing
    Changed bool
}
```

<a name="ValueRef"></a>
## type [ValueRef](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L17-L26>)

ValueRef represents a Helm value reference found in templates. It tracks where values are used in templates and their default values if specified.

```go
type ValueRef struct {
    // Path is the full dot-notation path to the value (e.g. "gateway.domain")
    Path string
    // DefaultValue is the value specified in the template using the default function
    DefaultValue string
    // SourceFile is the template file where this reference was found
    SourceFile string
    // LineNumber is the line number in the source file where the reference appears
    LineNumber int
}
```

<a name="ParseFile"></a>
### func [ParseFile](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/parser.go#L23>)

```go
func ParseFile(content, templatePath string) []ValueRef
```

ParseFile parses a template file and returns all value references

<a name="ValueRef.ID"></a>
### func \(\*ValueRef\) [ID](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L29>)

```go
func (v *ValueRef) ID() string
```

ID returns a unique identifier for the value reference

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
