<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# shcv

```go
import "github.com/agentstation/shcv/pkg/shcv"
```

Package shcv provides functionality to synchronize Helm chart values by analyzing template files and updating values.yaml accordingly.

The package helps maintain Helm charts by automatically detecting all \{\{ .Values.\* \}\} expressions in template files and ensuring they are properly defined in the values file. It uses atomic file operations to ensure data integrity and provides robust error handling.

Version: 1.0.0 Requires: Go 1.21 or later

Basic usage:

```
import "github.com/agentstation/shcv/pkg/shcv"

// Create a new chart instance with default options
chart, err := shcv.NewChart("./my-chart", nil)
if err != nil {
	log.Fatal(err)
}

// Load and process the chart
if err := chart.LoadValues(); err != nil {
	log.Fatal(err)
}
if err := chart.FindTemplates(); err != nil {
	log.Fatal(err)
}
if err := chart.ParseTemplates(); err != nil {
	log.Fatal(err)
}
if err := chart.UpdateValues(); err != nil {
	log.Fatal(err)
}
```

Custom options:

```
opts := &shcv.Options{
	ValuesFileName: "custom-values.yaml",
	TemplatesDir:   "custom-templates",
	DefaultValues: map[string]string{
		"domain":   "custom.example.com",
		"port":     "8080",
		"replicas": "3",
	},
}
chart, err := shcv.NewChart("./my-chart", opts)
```

Features:

- Detects all Helm value references in template files
- Supports nested value structures \(e.g., \{\{ .Values.gateway.domain \}\}\)
- Handles default values in templates \(e.g., \{\{ .Values.domain | default "api.example.com" \}\}\)
- Supports double\-quoted, single\-quoted, and numeric default values
- Creates missing values in values.yaml with their default values
- Preserves existing values and structure in your values file
- Provides line number and source file tracking for each reference
- Uses atomic file operations to prevent data corruption
- Provides robust error handling with detailed messages
- Safely handles concurrent chart updates

Error Handling:

- Invalid chart directory structure
- Missing or inaccessible templates directory
- Permission issues with values.yaml
- Invalid YAML syntax in templates or values
- Concurrent file access conflicts

## Index

- [Constants](<#constants>)
- [type Chart](<#Chart>)
  - [func NewChart\(dir string, opts \*Options\) \(\*Chart, error\)](<#NewChart>)
  - [func \(c \*Chart\) FindTemplates\(\) error](<#Chart.FindTemplates>)
  - [func \(c \*Chart\) LoadValues\(\) error](<#Chart.LoadValues>)
  - [func \(c \*Chart\) ParseTemplates\(\) error](<#Chart.ParseTemplates>)
  - [func \(c \*Chart\) UpdateValues\(\) error](<#Chart.UpdateValues>)
- [type Options](<#Options>)
  - [func DefaultOptions\(\) \*Options](<#DefaultOptions>)
- [type ValueRef](<#ValueRef>)


## Constants

<a name="Version"></a>Version is the current version of the shcv package

```go
const Version = "1.0.0"
```

<a name="Chart"></a>
## type [Chart](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L33-L48>)

Chart represents a Helm chart structure and manages its values and templates. It provides functionality to scan templates for value references and ensure all referenced values are properly defined in values.yaml.

```go
type Chart struct {
    // Dir is the root directory of the chart
    Dir string
    // ValuesFile is the path to values.yaml
    ValuesFile string
    // Values contains the current values from values.yaml
    Values map[string]any
    // References tracks all .Values references found in templates
    References []ValueRef
    // Templates lists all discovered template files
    Templates []string
    // Changed indicates whether values were modified during processing
    Changed bool
    // contains filtered or unexported fields
}
```

<a name="NewChart"></a>
### func [NewChart](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L94>)

```go
func NewChart(dir string, opts *Options) (*Chart, error)
```

NewChart creates a new Chart instance for processing a Helm chart. It validates the chart directory and initializes the chart with the given options. If opts is nil, default options are used.

<a name="Chart.FindTemplates"></a>
### func \(\*Chart\) [FindTemplates](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L157>)

```go
func (c *Chart) FindTemplates() error
```

FindTemplates discovers all template files in the chart's templates directory. It looks for files with .yaml, .yml, or .tpl extensions. Returns an error if the templates directory cannot be accessed.

<a name="Chart.LoadValues"></a>
### func \(\*Chart\) [LoadValues](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L139>)

```go
func (c *Chart) LoadValues() error
```

LoadValues loads the current values from the values.yaml file. If the file doesn't exist, an empty values map is initialized. Returns an error if the file exists but cannot be read or parsed.

<a name="Chart.ParseTemplates"></a>
### func \(\*Chart\) [ParseTemplates](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L178>)

```go
func (c *Chart) ParseTemplates() error
```

ParseTemplates scans all discovered templates for .Values references. It identifies both simple references and those with default values. The references are stored in the Chart's References slice.

<a name="Chart.UpdateValues"></a>
### func \(\*Chart\) [UpdateValues](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L274>)

```go
func (c *Chart) UpdateValues() error
```

UpdateValues ensures all referenced values exist in values.yaml. It adds missing values with appropriate defaults and updates the file atomically. The operation is skipped if no changes are needed.

<a name="Options"></a>
## type [Options](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L67-L74>)

Options configures the behavior of Chart processing. It allows customization of file locations and default values.

```go
type Options struct {
    // ValuesFileName is the name of the values file to use (default: "values.yaml")
    ValuesFileName string
    // TemplatesDir is the name of the templates directory (default: "templates")
    TemplatesDir string
    // DefaultValues provides default values for specific key patterns
    DefaultValues map[string]string
}
```

<a name="DefaultOptions"></a>
### func [DefaultOptions](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L78>)

```go
func DefaultOptions() *Options
```

DefaultOptions returns the default configuration options for Chart processing. This includes standard file locations and common default values.

<a name="ValueRef"></a>
## type [ValueRef](<https://github.com/agentstation/shcv/blob/master/pkg/shcv/pkg/shcv/shcv.go#L19-L28>)

ValueRef represents a Helm value reference found in templates. It tracks where values are used in templates and their default values if specified.

```go
type ValueRef struct {
    // Path is the full dot-notation path to the value (e.g. "gateway.domain")
    Path string
    // DefaultValue is the value specified in the template using the default function
    DefaultValue string
    // SourceFile is the template file where this reference was found
    SourceFile string
    // LineNumber is the line number in the source file where the reference appears
    LineNumber int
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
